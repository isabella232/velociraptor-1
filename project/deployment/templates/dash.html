{% extends 'base.html' %}
{% load stripchar %}
{% load static from staticfiles %}

{% block content %}
<div class="row-fluid">

  <div class="proc-column span9">
    <h1>App Status</h1>
    <table id="dash-apps"></table>
  </div>

  <div class="tasks-column span3">
      <div id="dash-tasks">
        <h1>Tasks</h1>
        <div id="tasks-list"></div>
      </div>
  </div>
</div>
{% endblock content %}


{% block script %}
<script src="{% static 'js/backbone-min.js' %}"></script>
<script src="{% static 'js/vrdash.js' %}"></script>


{# Goatee template for task item summary#}
<script id="task-tmpl" type="text/goatee">
<div id="task-<%task_id%>" class="task-wrapper">
  <div class="task-status <%state%>" data-proc="<%name%>">
    <a href="#"><%shortname%></a>
  </div>
</div>
</script>


{# Goatee template for task item details modal#}
<script id="task-modal-tmpl" type="text/goatee">
    <div id="task-details-<%task_id%>" class="modal task-details">
    <div class="modal-header">
        <a class="close" data-dismiss="modal">Ã—</a>
        <h3>Task Details</h3>
    </div>
    <div class="modal-body">
        <table class="table table-condensed">
            <dl>
                <dt>Name
                <dd><%name%>

                <dt>Task ID
                <dd><%task_id%>

                <dt>Args
                <dd><%args%>

                <dt>Kwargs
                <dd><%kwargs%>

                <dt>Tstamp
                <dd><%prettydate%>

                <%#runtime%>
                <dt>Run time
                <dd><%runtime%>
                <%/runtime%>

                <%#eta%>
                    <dt>ETA
                    <dd><%eta%>
                <%/eta%>

                <%#expires%>
                    <dt>Expires
                    <dd><%expires%>
                <%/expires%>

                <dt>State
                <dd><%state%>

                <%#retries%>
                    <dt>Retries
                    <dd><%retries%>
                <%/retries%>

                <dt>Result
                <dd><%result%>

                <%#traceback%>
                    <dt>Traceback
                    <dd><pre><%traceback%></pre>
                <%/traceback%>
            </dl>
        </table>


    </div>
    </div>
</script>

<script>
//// Fire in the hole! ////
$(document).ready(function(){
  VR.Dash.Tasks.init();
  VR.Dash.Apps = new AppList($('#dash-apps'));
  VR.Dash.getHostList();
});
</script>
{% endblock script %}
