{% extends 'base.html' %}
{% load stripchar %}
{% load static from staticfiles %}

{% block content %}
<div class="row-fluid">
<div class="proc-column span9">
<h1>Procs <small>as reported by supervisord </small></h1>
<div class="proc-filters">
  <div class="btn-group statusfilters procbar" data-toggle="buttons-radio">
    <button class="btn btn-mini btn-inverse procfilter" data-filter="*">All</button>
    <button class="btn btn-mini btn-success procfilter" data-filter=".status-RUNNING">Running</button>
    <button class="btn btn-mini btn-warning procfilter" data-filter=".status-STOPPED">Stopped</button>
    <button class="btn btn-mini btn-danger procfilter" data-filter=".status-FATAL">Fatal</button>
  </div>
  <div class="btn-group hostlist procbar">
    <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#">
      By Host
      <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
      {% for host in hosts %}
      <li><a href="#" class="procfilter" data-filter=".host-{{ host.name|stripchar:"." }}">{{ host }}</a>
      {% endfor %}
    </ul>
  </div>
  <div class="btn-group applist procbar">
    <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#">
      By App
      <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
      {% for app in apps %}
      <li><a href="#" class="procfilter" data-filter=".app-{{ app.name|stripchar:"." }}">{{ app }}</a>
      {% endfor %}
    </ul>
  </div>
  <div class="btn-group expandcollapse procbar">
    <button class="btn btn-mini" rel="expand">Expand All</button>
    <button class="btn btn-mini" rel="collapse">Collapse All</button>
  </div>
</div>
<div id="dash-procs">
</div>
</div>
<div class="tasks-column span3">
    <div id="dash-tasks">
      <h1>Tasks</h1>
      <div id="tasks-list">
      </div>
    </div>
</div>
</div>
{% endblock content %}


{% block script %}
<script src="{% static 'js/jquery.isotope.js' %}"></script>
<script src="{% static 'js/dash.js' %}"></script>

{# Goatee template for list of processes inside each host block #}
<script id="host-procs-tmpl" type="text/goatee">
  <%#states%>
  <div id="<%procid%>" class="proc-status status-<%statename%> host-<%hostclass%> app-<%appclass%>" data-host="<%host%>" data-proc="<%name%>">
    <div class="label <%statename%>">
      <span class="shortname"><%shortname%></span>
      <span class="longname"><%name%></span>
    </div>
    <div class="host-more">
      <%host%><br />
      <%description%>
      <div class="proc-actions">
        <a class="btn btn-mini start" href="#" rel="start">Start</a>
        <a class="btn btn-mini stop" href="#" rel="stop">Stop</a>
        <%#destroyable%><a class="btn btn-mini destroy" href="#" rel="destroy">Destroy</a><%/destroyable%>
        <span class="links">
            <a href="http://<%host%>:{{ supervisord_web_port }}/logtail/<%name%>" target="_blank">Log Tail</a>
        </span>
       </div>

    </div>
  </div>
  <%/states%>
</ul>
</script>

{# Goatee template for task item summary#}
<script id="task-tmpl" type="text/goatee">
<div id="task-<%task_id%>" class="task-wrapper">
  <div class="task-status <%state%>" data-proc="<%name%>">
    <a href="#"><%shortname%></a>
  </div>
</div>
</script>

{# Goatee template for task item details modal#}
<script id="task-modal-tmpl" type="text/goatee">
    <div id="task-details-<%task_id%>" class="modal task-details">
    <div class="modal-header">
        <a class="close" data-dismiss="modal">×</a>
        <h3>Task Details</h3>
    </div>
    <div class="modal-body">
        <table class="table table-condensed">
            <dl>
                <dt>Name
                <dd><%name%>

                <dt>Task ID
                <dd><%task_id%>

                <dt>Args
                <dd><%args%>

                <dt>Kwargs
                <dd><%kwargs%>

                <dt>Tstamp
                <dd><%prettydate%>

                <%#runtime%>
                <dt>Run time
                <dd><%runtime%>
                <%/runtime%>

                <%#eta%>
                    <dt>ETA
                    <dd><%eta%>
                <%/eta%>

                <%#expires%>
                    <dt>Expires
                    <dd><%expires%>
                <%/expires%>

                <dt>State
                <dd><%state%>

                <%#retries%>
                    <dt>Retries
                    <dd><%retries%>
                <%/retries%>

                <dt>Result
                <dd><%result%>

                <%#traceback%>
                    <dt>Traceback
                    <dd><pre><%traceback%></pre>
                <%/traceback%>
            </dl>
        </table>

    </div>
    </div>
</script>

{# Goatee template for "are you sure you want to delete this proc?" #}
<script id="proc-modal-tmpl" type="text/goatee">
<div class="modal action-dialog">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3>Are you sure?</h3>
  </div>
  <div class="modal-body">
    <p>You're about to <%action%> <%proc%> on <%host%>.  Do you really want to do this?</p>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn" rel="cancel">No</a>
    <a href="#" class="btn btn-primary" rel="confirm">Do it!</a>
  </div>
</div>
</script>
{% endblock script %}
